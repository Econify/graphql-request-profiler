var data = [
  {
    execStartTimeMs: 10,
    execEndTimeMs: 274,
    execTimeMs: 264,
    location: 'page',
    parentType: 'Query',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 276,
    execTimeMs: 1,
    location: 'page.zoneSets.1.zones.0.widgets.0.items',
    parentType: 'ArticleHeader',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 276,
    execTimeMs: 1,
    location: 'page.zoneSets.1.zones.0.widgets.1.items',
    parentType: 'ArticleBody',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 276,
    execTimeMs: 1,
    location: 'page.zoneSets.1.zones.0.widgets.2.items',
    parentType: 'ArticleFooter',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 278,
    execTimeMs: 1,
    location: 'page.zoneSets.1.zones.0.widgets.1.items.0.body',
    parentType: 'Article',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 279,
    execTimeMs: 2,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.breadcrumbs',
    parentType: 'Article',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.0.zones.0.widgets.0.type',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.1.zones.1.widgets.0.type',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 177,
    location: 'page.zoneSets.2.zones.0.widgets.0.type',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.0.zones.0.widgets.0.options',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.0.zones.0.widgets.0.items',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.1.zones.1.widgets.0.options',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 178,
    location: 'page.zoneSets.1.zones.1.widgets.0.items',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 177,
    location: 'page.zoneSets.2.zones.0.widgets.0.options',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 275,
    execEndTimeMs: 453,
    execTimeMs: 177,
    location: 'page.zoneSets.2.zones.0.widgets.0.items',
    parentType: 'Collection',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.title',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.biography',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.url',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.slug',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 276,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.email',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.facebook',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.linkedIn',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.twitter',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.hasContact',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.title',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.biography',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.url',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.slug',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.email',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.facebook',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.linkedIn',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.twitter',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.hasContact',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 265,
    location: 'page.zoneSets.1.zones.0.widgets.0.items.0.authors.0.image',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 542,
    execTimeMs: 264,
    location: 'page.zoneSets.1.zones.0.widgets.2.items.0.authors.0.image',
    parentType: 'Author',
  },
  {
    execStartTimeMs: 277,
    execEndTimeMs: 2843,
    execTimeMs: 2289,
    location: 'ello.govna',
    parentType: 'Author',
  },
].map((item) => {
  return {
    name: item.location,
    end: item.execEndTimeMs,
    count: item.execTimeMs,
  };
});

function HorizontalWaterfallChart(attachTo, data) {
  const maxData = Math.max(...data.map((d) => d.end));
  const svgHeight = 2000;
  const svgWidth = 1500;
  const numTicks = 10;
  const recWidth = d3.min([50, svgHeight / data.length]); // Minimum width of the rect 50px;
  const leftMargin = 160;
  const lineHeight = data.length * recWidth;
  const colorScale = d3.scale.category10();

  // Append the chart and pad it a bit
  var chart = d3
    .select(attachTo)
    .append('svg')
    .attr('class', 'chart')
    .attr('width', svgWidth)
    .attr('height', svgHeight);

  // Set the x-axis scale
  var x = d3.scale
    .linear()
    .domain([0, maxData + 10])
    .range(['0px', `${svgWidth}px`]);

  // X-axis Label
  chart
    .append('g')
    .attr('transform', 'translate(' + svgWidth * 0.6 + ',15)')
    .attr('class', 'gAxisLabel')
    .append('text')
    .text('Time (ms)');

  // The main graph area
  chart = chart
    .append('g')
    .attr('transform', 'translate(' + leftMargin + ',30)')
    .attr('class', 'gMainGraphArea');

  // Set the y-axis scale
  chart
    .append('g')
    .attr('transform', 'translate(' + leftMargin + ',15)')
    .selectAll('rect')
    .data(data)
    .enter()
    .append('rect')
    .attr('class', 'rectWF')
    .attr('x', function (d, i) {
      return x(d.end - d.count);
    })
    .attr('y', function (d, i) {
      return i * recWidth;
    })
    .style('fill', function (d, i) {
      return colorScale(i);
    })
    .attr('height', recWidth)
    .attr('width', 0)
    // .on('mouseover', function () {
    //   d3.selectAll('.rectWF').style('opacity', 0.2);
    //   d3.select(this).style('opacity', 1);
    // })
    // .on('mouseout', function () {
    //   d3.selectAll('.rectWF').style('opacity', 1);
    // })
    .transition()
    .duration(1000)
    .attr('width', function (d, i) {
      return x(d.count);
    });

  // Set the values on the bars
  chart
    .append('g')
    .attr('transform', 'translate(' + leftMargin + ',15)')
    .selectAll('text')
    .data(data)
    .enter()
    .append('text')
    .attr('class', 'bar')
    .attr('x', function (d) {
      return x(d.end - d.count / 2);
    })
    .attr('y', function (d, i) {
      return i * recWidth + recWidth * 0.5;
    })
    .text(function (d) {
      return `${d.count}ms`;
    });

  // Set the vertical lines for axis
  chart
    .append('g')
    .attr('transform', 'translate(' + leftMargin + ',15)')
    .selectAll('line')
    .data(x.ticks(numTicks))
    .enter()
    .append('line')
    .attr('x1', x)
    .attr('x2', x)
    .attr('y1', 0)
    .attr('y2', 0)
    .transition()
    .duration(1500)
    .attr('y2', lineHeight)
    .style('stroke', '#ccc');

  // Set the numbering on the lines for axis
  chart
    .append('g')
    .attr('transform', 'translate(' + leftMargin + ',15)')
    .selectAll('.rule')
    .data(x.ticks(numTicks))
    .enter()
    .append('text')
    .attr('class', 'rule')
    .attr('x', x)
    .attr('y', 0)
    .attr('dy', -3)
    .attr('text-anchor', 'middle')
    .text(String);

  const ll = chart.append('g').attr('class', 'gAxis');

  // Set the base line at the left-most corner
  ll.append('line')
    .attr('x1', leftMargin)
    .attr('x2', leftMargin)
    .attr('y1', 15)
    .attr('y2', 15 + lineHeight)
    .style('stroke', '#000');

  ll.selectAll('text')
    .data(data)
    .enter()
    .append('text')
    .attr('x', leftMargin - 10)
    .attr('y', function (d, i) {
      return i * recWidth + recWidth * 0.8;
    })
    .attr('dx', -5) // padding-right
    .attr('dy', '0') // vertical-align: middle
    .attr('text-anchor', 'end') // text-align: right
    .text(function (d, i) {
      return d.name;
    });
}

HorizontalWaterfallChart('body', data);
